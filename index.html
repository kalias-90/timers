<html>
    <head>
        <title>Timers</title>
        <style type="text/css">
            body {
                background: #60d7e2;
                font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
                font-size: 1.5em;
                margin: 0;
                color:#383430;
            }
            button, input {
                font-size: inherit;
            }
            main {
                max-width: 500px;
                margin: 20px auto 0 auto;
            }
            ul#timers {
                list-style: none;
                padding: 10px;
                background: #d3ecee;
                border: 3px solid #5e8b8f;
            }
            ul#timers>li {
                border-left: 10px solid #e68dc1;
                padding: 5px 0px 5px 10px;
            }
            ul#timers>li.paused {
                background: yellow;
            }
            ul#timers>li:nth-child(even) {
                border-left-color: #a6b1e2;
            }
            #errorMessage {
                background: pink;
                border: 1px solid red;
            }
        </style>
    </head>
    <body>
        <script>

            class TimerError extends Error {
                constructor(message) {
                    super(message);
                    this.name = 'TimerError';
                }
            }

            class Timer {
                constructor ({
                    name, onTick, onResumed, onPaused, onStopped
                }) {
                    if (!name) {
                        throw new TimerError('Timer name required.');
                    }

                    this.name = name;
                    this.seconds = 0;
                    this.paused = true;
                    this.onTick = () => onTick(
                        this.seconds/3600>>0,
                        this.seconds%3600/60>>0,
                        this.seconds%3600%60
                    );
                    this.onResumed = onResumed;
                    this.onPaused = onPaused;
                    this.onStopped = onStopped;

                    this.start();
                }

                static pauseOnStart = true;
                static timers = new Map();
                static clock = setInterval(() => {
                    for (let timer of Timer.timers.values()) {
                        timer.tick();
                    }
                }, 1000);

                start () {
                    if(Timer.timers.has(this.name)) {
                        throw new TimerError(`Timer with name ${this.name} already started.`);
                    }
                    if (Timer.pauseOnStart) {
                        for (let timer of Timer.timers.values()) {
                            timer.pause();
                        }
                    }
                    Timer.timers.set(this.name, this);

                    this.onTick();
                    this.resume();
                }
                
                resume () {
                    if (this.paused) {
                        this.paused = false;
                        this.onResumed();
                    }
                }

                tick () {
                    if (!this.paused) {
                        this.seconds++;
                        this.onTick();
                    }
                }
                
                pause () {
                    if (!this.paused) {
                        this.paused = true;
                        this.onPaused();
                    }
                }

                stop () {
                    if (Timer.timers.has(this.name)) {
                        Timer.timers.delete(this.name);
                        this.onStopped();
                    }
                }
            }
        </script>

        <main>
            <p id="errorMessage"></p>

            <input id="newTimerName"/>
            <button id="createTimer">Create</button>

            <ul id="timers"></ul>

            <template id="timerTemplate" class="timer">
                <span class="name">${timerName}</span>
                <span class="time"></span>
                <button class="resume">Resume</button>
                <button class="pause">Pause</button>
                <button class="stop">Stop</button>
            </template>
        </main>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const nameInput = document.getElementById('newTimerName');
                const timersContainer = document.getElementById('timers');
                const timerTemplate = document.getElementById('timerTemplate');
                const timerCreate = document.getElementById('createTimer');
                const errorMessage = document.getElementById('errorMessage');

                const clearErrorMessage = () => {
                    errorMessage.textContent = '';
                }
                const showErrorMessage = (message) => {
                    clearErrorMessage();
                    errorMessage.textContent = message;
                };

                timerCreate.addEventListener('click', () => {
                    clearErrorMessage();

                    const name = nameInput.value;
                    nameInput.value = '';

                    const timerElement = document.createElement('li');
                    timerElement.class = 'timer';
                    timerElement.innerHTML = timerTemplate.innerHTML.replace('${timerName}', name);
                    const timeLabel = timerElement.querySelector('span.time');
                    const resumeButton = timerElement.querySelector('button.resume');
                    const pauseButton = timerElement.querySelector('button.pause');
                    const stopButton = timerElement.querySelector('button.stop');

                    timersContainer.prepend(timerElement);

                    try {
                        const timer = new Timer({
                            name,
                            onTick: (h, m, s) => {
                                timeLabel.textContent = `${h}h ${m}m ${s}s`;
                            },
                            onResumed: () => timerElement.classList.remove('paused'),
                            onPaused: () => timerElement.classList.add('paused'),
                            onStopped: () => timerElement.remove()
                        });
                        
                        resumeButton.addEventListener('click', (e) => {
                            clearErrorMessage();
                            timer.resume();
                        });
                        pauseButton.addEventListener('click', (e) => {
                            clearErrorMessage();
                            timer.pause();
                        });
                        stopButton.addEventListener('click', (e) => {
                            clearErrorMessage();
                            timer.stop();
                        });

                    } catch (error) {
                        if (error instanceof TimerError) {
                            showErrorMessage(error.message);
                            timerElement.remove();
                        } else {
                            throw error;
                        }
                    }
                });
            });
        </script>
    </body>
</html>